<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Print Abstract of Bids</title>
    <script src="https://js.arcgis.com/4.20/"></script>
    <script>
        function executeGeoprocessing(serviceURL, clickedButton) {
            var outputFileUrl;
            var params = {};
            var urlParams = new URLSearchParams(window.location.search);
            params.contract = urlParams.get('cid');
            
            // Change the button to show loading icon
            clickedButton.innerHTML = "Loading...";
            clickedButton.classList.add("loading");

            require([
                "esri/tasks/Geoprocessor",
                "esri/rest/support/JobInfo"
            ], function(Geoprocessor, JobInfo) {
                var gp = new Geoprocessor(serviceURL);
                gp.submitJob(params).then((jobInfo) => {
                    const jobid = jobInfo.jobId;

                    const options = {
                        interval: 1500,
                        statusCallback: (j) => {
                            console.log("Job Status: ", j.jobStatus);
                        }
                    };

                    jobInfo.waitForJobCompletion(options).then(() => {
                        jobInfo.fetchResultData('outfile').then(function(result) {
                            outputFileUrl = result.value.url;
                            window.open(outputFileUrl, "_blank");

                            // Restore the button to its original state
                            clickedButton.innerHTML = clickedButton.getAttribute("data-original-text");
                            clickedButton.classList.remove("loading");
                        });
                    });
                });
            });
        }

        document.addEventListener("DOMContentLoaded", function(event) {
            var buttons = document.querySelectorAll(".run-geoprocessing-tool");
            buttons.forEach(function(button) {
                button.setAttribute("data-original-text", button.innerHTML);
                button.addEventListener("click", function(event) {
                    event.preventDefault();
                    executeGeoprocessing(this.getAttribute("data-service-url"), this);
                });
            });
        });
    </script>
</head>
<style>
    .run-geoprocessing-tool {
        display: inline-block;
        background-color: #7b8361
;
        color: white;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        font-size: 12px;
        margin: 4px 2px;
        cursor: pointer;
        border: none;
        border: 1px solid black;
        /* Added black border */
        transition: font-weight 0.3s;
        /* Added transition for font-weight */
    }
    
    .run-geoprocessing-tool:hover {
        border: 2px solid black;
        /* Font goes bold on hover */
    }
    
    body {
        font-family: Arial, sans-serif;
    }


    .run-geoprocessing-tool.loading {
        cursor: not-allowed;
        background-color: #aaa;
    }
    
    .button-container {
        display: flex;
        justify-content: center;
    }
</style>

<body>
    <div class="button-container">
        <a href="#" data-service-url="https://arcportal-ucop-corps.usace.army.mil/gp/rest/services/PrepareAbstractOfBids/GPServer/Prepare%20Abstract%20of%20Bids" id="run-geoprocessing-tool-1" class="run-geoprocessing-tool">Abstract (Scaled)</a>
        <a href="#" id="run-geoprocessing-tool-2" class="run-geoprocessing-tool">Abstract (Lump Sum)</a>
        <a href="#" id="run-geoprocessing-tool-3" class="run-geoprocessing-tool">Check Return Letter</a>
        <a href="#" id="run-geoprocessing-tool-4" class="run-geoprocessing-tool">No Bids Returned Statement</a>
    </div>
</body>


</html>



