<!DOCTYPE html>
<html>

<head>
    <title>REMIS Data Entry</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
    <script src="https://js.arcgis.com/4.21/"></script>
    <style>
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        input[type="radio"] {
    display: none; /* Hide the default radio button */
}

label {
    display: inline-block;
    padding: 10px 20px;
    margin: 5px;
    border: 1px solid #ccc;
    cursor: pointer;
    transition: background 0.3s;
}

/* Style label when the associated radio button is checked */
input[type="radio"]:checked + label {
    background-color: #45a049; /* You can choose any color you like */
    color: #ffffff; /* You can choose any color you like */
}

        html,
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
        }

        #viewDiv {
            padding: 0;
            margin: 0;
            height: 200px;
            width: 100%;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 5px;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
        }

        .form-group1 {
            display: flex;
            flex-wrap: wrap;
            /* This will allow items to wrap into the next row if there is not enough space */
            gap: 5px;
            /* Adjust the gap according to your needs */
            align-items: center;
        }

        .form-group2 {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 5px;
            align-items: center;
            margin-bottom: 10px;
        }


        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .submit-btn {
            display: flex;
            justify-content: center;
        }

        .submit-btn input {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .submit-btn input:hover {
            background-color: #45a049;
        }

        .checkbox-container input {
            margin-right: 5px;
        }

        fieldset {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }

        .form-groupf {
            display: flex;
            flex-wrap: wrap;
            /*justify-content: space-between;*/
            /* Adjust as per design needs */
        }

        .form-groupf input[type="radio"] {
            margin: 5px;
        }

        .form-groupf label {
            font-size: 14px;
            /* Adjust as per design needs */
            color: #333;
            /* Adjust as per design needs */
        }

        .group-title {
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        fieldset {
            border: 1px solid #000000;
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 5px;
            align-items: center;
            margin-bottom: 5px;
        }

        hr {
    border: .5px solid #9f9f9f;
    border-style: solid;
    width: 100%;
}

.collapsible-content {
  transition: max-height 0.3s ease;
  max-height: 200px; /* Adjust to suit your needs */
  overflow: hidden;
}

.collapsed .collapsible-content {
  max-height: 0;
}

.collapsible-legend {
  cursor: pointer;
}

            fieldset legend {
                font-size: 1em;
                font-weight: bold;
                padding: 0 5px;
            }
    </style>
</head>

<body>
    <form id="dataForm">
        <fieldset class="collapsible collapsed">
            <legend class="collapsible-legend">User Data (Click to Expand)</legend>
            <div class="collapsible-content">
                <select id="created_user" name="created_user">
                    <option value="None">None</option>
                </select>
                <input type="text" id="EMP_ID_NO" name="EMP_ID_NO" placeholder="Employee Number">
                <input type="text" id="P_WI_RESPONSIBLE_ORG" name="P_WI_RESPONSIBLE_ORG" placeholder="Org Code">
                <input type="text" id="P_DIV_DIST" name="P_DIV_DIST" placeholder="District">
            </div>
        </fieldset>

        <fieldset>
            <legend>Process</legend>
            <div class="form-groupf" id="process">
                <input type="radio" id="process_acquisition" name="process_select" value="Acquisition">
                <label for="process_acquisition">Acquisition</label>

                <input type="radio" id="process_right_of_entry" name="process_select" value="Acquire Right-of-Entry">
                <label for="process_right_of_entry">Acquire Right-of-Entry</label>

                <input type="radio" id="process_licenses" name="process_select" value="Acquire Licenses and Permits">
                <label for="process_licenses">Acquire Licenses and Permits</label>

                <input type="radio" id="process_withdrawal" name="process_select" value="Withdrawal/Transfer/Donation">
                <label for="process_withdrawal">Withdrawal/Transfer/Donation</label>

                <input type="radio" id="process_appraisal" name="process_select" value="Appraisal">
                <label for="process_appraisal">Appraisal</label>

                <input type="radio" id="process_title_search" name="process_select" value="Title/Record Search">
                <label for="process_title_search">Title/Record Search</label>

                <input type="radio" id="process_project_support" name="process_select"
                    value="Project Development Support">
                <label for="process_project_support">Project Development Support</label>

                <input type="radio" id="process_gis" name="process_select" value="GIS/Mapping">
                <label for="process_gis">GIS/Mapping</label>

                <input type="radio" id="process_sponsor_oversight" name="process_select"
                    value="Non-Federal Sponsor Oversight">
                <label for="process_sponsor_oversight">Non-Federal Sponsor Oversight</label>

            </div>
            <hr>
            <div class="form-groupf" id="activity">
                <div class="form-group1" id="activity-Acquisition" style="display:none">
                    <input type="radio" id="landowner_negotiation_acquisition" name="activity_select"
                        value="Landowner Negotiation (Acquisition)">
                    <label for="landowner_negotiation_acquisition">Landowner Negotiation (Acquisition)</label>
                    <input type="radio" id="landowner_negotiation_condemnation" name="activity_select"
                        value="Landowner Negotiation (Condemnation)">
                    <label for="landowner_negotiation_condemnation">Landowner Negotiation (Condemnation)</label>
                    <input type="radio" id="execute_offer_to_sell" name="activity_select" value="Execute Offer to Sell">
                    <label for="execute_offer_to_sell">Execute Offer to Sell</label>
                    <input type="radio" id="executed_deed" name="activity_select" value="Executed Deed">
                    <label for="executed_deed">Executed Deed</label>
                    <input type="radio" id="declaration_of_taking" name="activity_select" value="Declaration of Taking">
                    <label for="declaration_of_taking">Declaration of Taking</label>

                </div>
                <div class="form-group1" id="activity-Acquire_Right-of-Entry" style="display:none;">
                    <input type="radio" id="right_of_entry_executed" name="activity_select"
                        value="Right-of-Entry Executed">
                    <label for="right_of_entry_executed">Right-of-Entry Executed</label>
                </div>
                <div class="form-group1" id="activity-Acquire_Licenses_and_Permits" style="display:none;">
                    <input type="radio" id="license_or_permit_executed" name="activity_select"
                        value="License or Permit Executed">
                    <label for="license_or_permit_executed">License or Permit Executed</label>
                </div>
                <div class="form-group1" id="activity-Withdrawal_Transfer_Donation" style="display:none;">
                    <input type="radio" id="executed_deed_or_letter_of_transfer" name="activity_select"
                        value="Executed Deed or Letter of Transfer">
                    <label for="executed_deed_or_letter_of_transfer">Executed Deed or Letter of Transfer</label>
                    <input type="radio" id="signed_document_for_acquisition_or_relinquishment_of_withdrawn_lands"
                        name="activity_select"
                        value="Signed Document for Acquisition or Relinquishment of Withdrawn Lands">
                    <label for="signed_document_for_acquisition_or_relinquishment_of_withdrawn_lands">Signed Document
                        for Acquisition or Relinquishment of Withdrawn Lands</label>
                </div>
                <div class="form-group1" id="activity-Appraisal" style="display:none;">
                    <input type="radio" id="completed_valuation_product" name="activity_select"
                        value="Completed Valuation Product">
                    <label for="completed_valuation_product">Completed Valuation Product</label>
                    <input type="radio" id="completed_government_review" name="activity_select"
                        value="Completed Government Review">
                    <label for="completed_government_review">Completed Government Review</label>
                </div>
                <div class="form-group1" id="activity-Title_Record_Search" style="display:none;">
                    <input type="radio" id="title_and_record_search" name="activity_select"
                        value="Title and Record Search">
                    <label for="title_and_record_search">Title and Record Search</label><br>
                    <input type="radio" id="developed_scope_of_work" name="activity_select"
                        value="Developed Scope of Work">
                    <label for="developed_scope_of_work">Developed Scope of Work</label><br>
                    <input type="radio" id="cor_review" name="activity_select" value="COR Review">
                    <label for="cor_review">COR Review</label><br>
                    <input type="radio" id="certification_of_real_estate_availability" name="activity_select"
                        value="Certification of Real Estate Availability">
                    <label for="certification_of_real_estate_availability">Certification of Real Estate
                        Availability</label>
                </div>
                <div class="form-group1" id="activity-Project_Development_Support" style="display:none;">
                    <input type="radio" id="project_development_support_activity" name="activity_select"
                        value="Project Development Support Activity">
                    <label for="project_development_support_activity">Project Development Support Activity</label><br>
                    <input type="radio" id="real_estate_planning_document_review" name="activity_select"
                        value="Real Estate Planning Document Review">
                    <label for="real_estate_planning_document_review">Real Estate Planning Document Review</label><br>
                    <input type="radio" id="district_quality_control_review" name="activity_select"
                        value="District Quality Control Review">
                    <label for="district_quality_control_review">District Quality Control Review</label><br>
                    <input type="radio" id="alternative_team_review" name="activity_select"
                        value="Alternative Team Review">
                    <label for="alternative_team_review">Alternative Team Review</label>
                </div>
                <div class="form-group1" id="activity-GIS_Mapping" style="display:none;">
                    <input type="radio" id="land_or_field_survey_data_review" name="activity_select"
                        value="Land or Field Survey Data Review">
                    <label for="land_or_field_survey_data_review">Land or Field Survey Data Review</label><br>
                    <input type="radio" id="legal_description" name="activity_select" value="Legal Description">
                    <label for="legal_description">Legal Description</label><br>
                    <input type="radio" id="validation_of_geospatial_data" name="activity_select"
                        value="Validation of Geospatial Data">
                    <label for="validation_of_geospatial_data">Validation of Geospatial Data</label><br>
                    <input type="radio" id="map_product" name="activity_select" value="Map Product">
                    <label for="map_product">Map Product</label><br>
                    <input type="radio" id="project_maps_and_data_archived" name="activity_select"
                        value="Project maps and Data Archived">
                    <label for="project_maps_and_data_archived">Project Maps and Data Archived</label><br>
                </div>
                <div class="form-group1" id="activity-Non-Federal_Sponsor_Oversight" style="display:none;">
                    <input type="radio" id="letter_to_the_non_federal_sponsor" name="activity_select"
                        value="Letter to the Non-Federal Sponsor">
                    <label for="letter_to_the_non_federal_sponsor">Letter to the Non-Federal Sponsor</label><br>
                    <input type="radio" id="reviewed_approved_nfs_agreement" name="activity_select"
                        value="Reviewed/Approved NFS agreement">
                    <label for="reviewed_approved_nfs_agreement">Reviewed/Approved NFS agreement</label><br>
                    <input type="radio" id="certification_of_real_estate_availability" name="activity_select"
                        value="Certification of Real Estate Availability">
                    <label for="certification_of_real_estate_availability">Certification of Real Estate
                        Availability</label>
                </div>
            </div>
        </fieldset>
        <div class="form-group">
            <fieldset style="width: 100%; box-sizing: border-box;">
                <legend>Task Info</legend>
                <div style="display: flex; gap: 10px; box-sizing: border-box;">
                    <input type="text" id="P_WI_NAME" name="P_WI_NAME" placeholder="Task Name" style="flex: 1; box-sizing: border-box;">
                    <input list="projectIds" id="P_PROJ_ID" name="P_PROJ_ID" placeholder="Project ID" style="flex: 1; box-sizing: border-box;">
                    <datalist id="projectIds">
                        <!-- The options will be populated here -->
                    </datalist>
                    <input type="text" id="P_P2_WI_CODE" name="P_P2_WI_CODE" placeholder="Work Item" style="flex: 1; box-sizing: border-box;">
                </div>
            </fieldset>
        </div>
        <div class="form-group2" id="content">
            <!--Acquisition-->
            <div id="content-landowner_negotiation_acquisition" style="display:none;">
            </div>
            <div id="content-landowner_negotiation_condemnation" style="display:none;">
            </div>
            <div id="content-execute_offer_to_sell" style="display:none;">
            </div>
            <div id="content-executed_deed" style="display:none;">
            </div>
            <div id="content-declaration_of_taking" style="display:none;">
            </div>

            <!--Acquire Right-of-Entry-->
<div class="form-group2" id="content-right_of_entry_executed" style="display:none;">
    <fieldset>
        <legend>Required Info</legend>
        <label>Permit Description:
            <select id="P_PERMIT_DESCRIPTION_1" name="P_PERMIT_DESCRIPTION" onchange="toggleOldNumberInput(this.value)">
                <option value="NEW SIGNATURE">NEW</option>
                <option value="RENEWAL">RENEWAL</option>
                <option value="REFUSAL">RENEWAL</option>
            </select>
        </label>
        <label><input type="text" id="P_PARCEL_NO_1" name="P_PARCEL_NO" placeholder="Parcel Number"></label>
        <label><input type="text" id="P_DAC_NO_1" name="P_DAC_NO" placeholder="New DACA/DACW Number"></label>
        <label id="oldNumberLabel" style="display:none;"><input type="text" id="P_DAC_NO_OLD_1" name="P_DAC_OLD_NO" placeholder="Old DACA/DACW Number"></label>
    </fieldset>
</div>

            <!--Acquire Licenses and Permits-->
            <div id="content-license_or_permit_executed" style="display:none;">
            </div>

            <!--Withdrawal/Transfer/Donation-->
            <div id="content-executed_deed_or_letter_of_transfer" style="display:none;">
            </div>
            <div id="content-signed_document_for_acquisition_or_relinquishment_of_withdrawn_lands"
                style="display:none;">
            </div>

            <!--Appraisal-->
            <div id="content-completed_valuation_product" style="display:none;">
            </div>
            <div id="content-completed_government_review" style="display:none;">
            </div>

            <!--Title/Record Search-->
            <div id="content-title_and_record_search" style="display:none;">
            </div>
            <div id="content-developed_scope_of_work" style="display:none;">
            </div>
            <div id="content-cor_review" style="display:none;">
            </div>
            <div id="content-certification_of_real_estate_availability" style="display:none;">
            </div>

            <!--Project Development Support-->
            <div id="content-project-development" style="display:none;">
                <label><input type="text" id="P_MEETING_DESC_1" name="P_MEETING_DESC"
                        placeholder="Meeting Description"></label><br>
            </div>
            <div id="content-real_estate_planning_document_review" style="display:none;">
            </div>
            <div id="content-district_quality_control_review" style="display:none;">
            </div>
            <div id="content-alternative_team_review" style="display:none;">
            </div>

            <!--NON FED SPONSOR-->
            <div id="content-letter_to_the_non_federal_sponsor" style="display:none;">
            </div>
            <div id="content-reviewed_approved_nfs_agreement" style="display:none;">
            </div>
            <div id="content-certification_of_real_estate_availability" style="display:none;">
            </div>

            <!--GIS/MAPPING-->
            <div class="form-group2" id="content-land-field-survey" style="display:none;">
                <fieldset>
                    <legend>Required Info</legend>
                    <label><input type="text" id="P_MAP_DESCRIPTION_1" name="P_MAP_DESCRIPTION"
                            placeholder="Map Description"></label>
                    <label><input type="text" id="P_PRIM_COUNTY_1" name="P_PRIM_COUNTY"
                            placeholder="County"></label>
                    <label><input type="text" id="P_PRIM_STATE_1" name="P_PRIM_STATE" placeholder="State"></label>
                </fieldset>
            </div>
            <div class="form-group2" id="content-legal_description" style="display:none;">
                <fieldset>
                    <legend>Required Info</legend>
                    <label><input type="text" id="P_MAP_DESCRIPTION_LAND_FIELD" name="P_MAP_DESCRIPTION"
                            placeholder="Map Description"></label>
                    <label><input type="text" id="P_PRIM_COUNTY_2" name="P_PRIM_COUNTY"
                            placeholder="County"></label>
                    <label><input type="text" id="P_PRIM_STATE_2" name="P_PRIM_STATE" placeholder="State"></label>
                </fieldset>
            </div>
            <div class="form-group2" id="content-validation_of_geospatial_data" style="display:none;">
                <fieldset>
                    <legend>Required Info</legend>
                    <label><input type="text" id="P_MAP_DESCRIPTION_LAND_FIELD" name="P_MAP_DESCRIPTION"
                            placeholder="Map Description"></label>
                    <label><input type="text" id="P_PRIM_COUNTY_3" name="P_PRIM_COUNTY"
                            placeholder="County"></label>
                    <label><input type="text" id="P_PRIM_STATE_3" name="P_PRIM_STATE" placeholder="State"></label>
                </fieldset>
            </div>
            <div class="form-group2" id="content-map_product" style="display:none;">
                <fieldset>
                    <legend>Required Info</legend>
                    <label><input type="text" id="P_MAP_DESCRIPTION_LAND_FIELD" name="P_MAP_DESCRIPTION"
                            placeholder="Map Description"></label>
                    <label><input type="text" id="P_PRIM_COUNTY_4" name="P_PRIM_COUNTY"
                            placeholder="County"></label>
                    <label><input type="text" id="P_PRIM_STATE_4" name="P_PRIM_STATE" placeholder="State"></label>
                </fieldset>
            </div>
            <div class="form-group2" id="content-project_maps_and_data_archived" style="display:none;">
                <fieldset>
                    <legend>Required Info</legend>
                    <label><input type="text" id="P_MAP_DESCRIPTION_LAND_FIELD" name="P_MAP_DESCRIPTION"
                            placeholder="Map Description"></label>
                    <label><input type="text" id="P_PRIM_COUNTY_5" name="P_PRIM_COUNTY"
                            placeholder="County"></label>
                    <label><input type="text" id="P_PRIM_STATE_5" name="P_PRIM_STATE" placeholder="State"></label>
                </fieldset>
            </div>

        </div>
        <div id="content"></div>
        <div class="submit-btn">
            <input type="submit" value="Submit">
        </div>
    </form>

    <script>
        let selectedState
        let selectedCounty
        let selectedProject
        let selectedProcess
        let selectedOrg
        let selectedEmployee
        let selectedDistrict
        let selectedActivity
        let div_dist
        const states = [
            document.getElementById('P_PRIM_STATE_1'),
            document.getElementById('P_PRIM_STATE_2'),
            document.getElementById('P_PRIM_STATE_3'),
            document.getElementById('P_PRIM_STATE_4'),
            document.getElementById('P_PRIM_STATE_5'),
        ];
        const counties = [
            document.getElementById('P_PRIM_COUNTY_1'),
            document.getElementById('P_PRIM_COUNTY_2'),
            document.getElementById('P_PRIM_COUNTY_3'),
            document.getElementById('P_PRIM_COUNTY_4'),
            document.getElementById('P_PRIM_COUNTY_5'),
        ];

        function toggleOldNumberInput(value) {
        var oldNumberLabel = document.getElementById('oldNumberLabel');
        if (value === 'RENEWAL') {
            oldNumberLabel.style.display = 'block';
        } else {
            oldNumberLabel.style.display = 'none';
        }
    }

        const todaydate = new Date().toISOString().slice(0, 10);
        console.log(todaydate);
        $('input[name="process_select"]').on('change', function () {
            const selectedValue = $(this).val();
            selectedProcess = selectedValue
            $('#activity > div').hide();
            $('#content > div').hide();
            $('#activity-' + selectedValue.replace(/\s+/g, '_').replace(/\//g, '_')).show();

        });

        document.addEventListener('DOMContentLoaded', function () {
            const contentDiv = document.getElementById('content');
            const activityDiv = document.getElementById('activity');

            activityDiv.addEventListener('change', function (e) {
                if (e.target.type === 'radio') {
                    $('#content > div').hide();
                    switch (e.target.value) {
                        case 'Landowner Negotiation (Acquisition)':
                            $('#content-landowner_negotiation_acquisition').show();
                            selectedActivity - 'Acquisition'
                            break;
                        case 'Landowner Negotiation (Condemnation)':
                            $('#content-landowner_negotiation_condemnation').show();
                            selectedActivity = 'Condemnation'
                            break;
                        case 'Execute Offer to Sell':
                            $('#content-execute_offer_to_sell').show();
                            selectedActivity - 'Acquisition'
                            break;
                        case 'Executed Deed':
                            $('#content-executed_deed').show();
                            selectedActivity - 'Acquisition'
                            break;
                        case 'Declaration of Taking':
                            $('#content-declaration_of_taking').show();
                            selectedActivity = 'Condemnation'
                            break;
                        case 'Right-of-Entry Executed':
                            $('#content-right_of_entry_executed').show();
                            selectedActivity = 'Acquire Right of Entry'
                            break;
                        case 'License or Permit Executed':
                            $('#content-license_or_permit_executed').show();
                            selectedActivity = 'Acquire License or Permit'
                            break;
                        case 'Executed Deed or Letter of Transfer':
                            $('#content-executed_deed_or_letter_of_transfer').show();
                            selectedActivity = 'Withdrawal/ Transfer/ Donation'
                            break;
                        case 'Signed Document for Acquisition or Relinquishment of Withdrawn Lands':
                            $('#content-signed_document_for_acquisition_or_relinquishment_of_withdrawn_lands').show();
                            selectedActivity = 'Acquire License or Permit'
                            break;
                        case 'Completed Valuation Product':
                            $('#content-completed_valuation_product').show();
                            selectedActivity = 'Appraisal'
                            break;
                        case 'Completed Government Review':
                            $('#content-completed_government_review').show();
                            selectedActivity = 'Appraisal'
                            break;
                        case 'Title and Record Search':
                            $('#content-title_and_record_search').show();
                            selectedActivity = 'Title and record Search'
                            break;
                        case 'Developed Scope of Work':
                            $('#content-developed_scope_of_work').show();
                            selectedActivity = 'Title and record Search'
                            break;
                        case 'COR Review':
                            $('#content-cor_review').show();
                            selectedActivity = 'Title and record Search'
                            break;
                        case 'Certification of Real Estate Availability':
                            $('#content-certification_of_real_estate_availability').show();
                            selectedActivity = 'Title and record Search'
                            break;
                        case 'Project Development Support Activity':
                            $('#content-project-development').show();
                            selectedActivity = 'Project Development Spt'
                            break;
                        case 'Real Estate Planning Document Review':
                            $('#content-real_estate_planning_document_review').show();
                            selectedActivity = 'Project Development Spt'
                            break;
                        case 'District Quality Control Review':
                            $('#content-district_quality_control_review').show();
                            selectedActivity = 'Project Development Spt'
                            break;
                        case 'Alternative Team Review':
                            $('#content-alternative_team_review').show();
                            selectedActivity = 'Project Development Spt'
                            break;
                        case 'Land or Field Survey Data Review':
                            $('#content-land-field-survey').show();
                            selectedActivity = 'Mapping and Survey'
                            break;
                        case 'Legal Description':
                            $('#content-legal_description').show();
                            selectedActivity = 'Mapping and Survey'
                            break;
                        case 'Validation of Geospatial Data':
                            $('#content-validation_of_geospatial_data').show();
                            selectedActivity = 'Mapping and Survey'
                            break;
                        case 'Map Product':
                            $('#content-map_product').show();
                            selectedActivity = 'Mapping and Survey'
                            break;
                        case 'Project maps and Data Archived':
                            $('#content-project_maps_and_data_archived').show();
                            selectedActivity = 'Mapping and Survey'
                            break;
                        case 'Letter to the Non-Federal Sponsor':
                            $('#content-letter_to_the_non_federal_sponsor').show();
                            selectedActivity = 'Non-Fed Sponsor Oversight'
                            break;
                        case 'Reviewed/Approved NFS agreement':
                            $('#content-reviewed_approved_nfs_agreement').show();
                            selectedActivity = 'Non-Fed Sponsor Oversight'
                            break;
                        case 'Certification of Real Estate Availability':
                            $('#content-certification_of_real_estate_availability').show();
                            selectedActivity = 'Non-Fed Sponsor'
                            break;
                        // Add more cases for other IDs as needed
                    }

                }
            });






            let featureMap = new Map();

            // Get the input field associated with the datalist
            const inputField = document.getElementById('P_PROJ_ID');

            inputField.addEventListener('input', function (e) {
                // Get the feature from the map using the input value
                const selectedFeature = featureMap.get(e.target.value);
                selectedProject = e.target.value;
                if (selectedFeature) {
                    let state = selectedFeature.attributes.state;
                    const state_dict = {
                        "AL": "ALABAMA",
                        "AK": "ALASKA",
                        "AZ": "ARIZONA",
                        "AR": "ARKANSAS",
                        "CA": "CALIFORNIA",
                        "CO": "COLORADO",
                        "CT": "CONNECTICUT",
                        "DE": "DELAWARE",
                        "FL": "FLORIDA",
                        "GA": "GEORGIA",
                        "HI": "HAWAII",
                        "ID": "IDAHO",
                        "IL": "ILLINOIS",
                        "IN": "INDIANA",
                        "IA": "IOWA",
                        "KS": "KANSAS",
                        "KY": "KENTUCKY",
                        "LA": "LOUISIANA",
                        "ME": "MAINE",
                        "MD": "MARYLAND",
                        "MA": "MASSACHUSETTS",
                        "MI": "MICHIGAN",
                        "MN": "MINNESOTA",
                        "MS": "MISSISSIPPI",
                        "MO": "MISSOURI",
                        "MT": "MONTANA",
                        "NE": "NEBRASKA",
                        "NV": "NEVADA",
                        "NH": "NEW HAMPSHIRE",
                        "NJ": "NEW JERSEY",
                        "NM": "NEW MEXICO",
                        "NY": "NEW YORK",
                        "NC": "NORTH CAROLINA",
                        "ND": "NORTH DAKOTA",
                        "OH": "OHIO",
                        "OK": "OKLAHOMA",
                        "OR": "OREGON",
                        "PA": "PENNSYLVANIA",
                        "RI": "RHODE ISLAND",
                        "SC": "SOUTH CAROLINA",
                        "SD": "SOUTH DAKOTA",
                        "TN": "TENNESSEE",
                        "TX": "TEXAS",
                        "UT": "UTAH",
                        "VT": "VERMONT",
                        "VA": "VIRGINIA",
                        "WA": "WASHINGTON",
                        "WV": "WEST VIRGINIA",
                        "WI": "WISCONSIN",
                        "WY": "WYOMING"
                    }
                    state = state_dict[state] || state; // Use the mapped value or the original value if not found in the map
                    document.getElementById('P_PRIM_STATE_1').value = state;
                    document.getElementById('P_PRIM_STATE_2').value = state;
                    document.getElementById('P_PRIM_STATE_3').value = state;
                    document.getElementById('P_PRIM_STATE_4').value = state;
                    document.getElementById('P_PRIM_STATE_5').value = state;

                    const county = selectedFeature.attributes.primary_county;
                    document.getElementById('P_PRIM_COUNTY_1').value = county;
                    document.getElementById('P_PRIM_COUNTY_2').value = county;
                    document.getElementById('P_PRIM_COUNTY_3').value = county;
                    document.getElementById('P_PRIM_COUNTY_4').value = county;
                    document.getElementById('P_PRIM_COUNTY_5').value = county;
                    selectedState = state;
                    selectedCounty = county;

                }
            });



            // GET PROJECTS
            function executeEsriRequest(divDistValue) {
                require(["esri/request", "dojo/domReady!"], function (esriRequest) {
                    esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Hosted/REMIS_Tasks/FeatureServer/3/query", {
                        responseType: "json",
                        query: {
                            where: "div_dist='" + divDistValue + "'",
                            outFields: "*",
                            resultRecordCount: 20000,
                            f: "json"
                        }
                    }).then(function (response) {

                        // Get the input fields
                        const dataList = document.getElementById('projectIds');

                        dataList.innerHTML = ''; // Clear existing options

                        // Sort and iterate through features
                        const sortedFeatures = response.data.features.sort((a, b) => {
                            if (a.attributes.proj_id < b.attributes.proj_id) return -1;
                            if (a.attributes.proj_id > b.attributes.proj_id) return 1;
                            return 0;
                        });

                        sortedFeatures.forEach(feature => {
                            const option = document.createElement('option');
                            option.value = feature.attributes.proj_id;
                            option.textContent = feature.attributes.proj_id + " - " + feature.attributes.proj_name;

                            // Store the feature in the map
                            featureMap.set(option.value, feature);

                            // Append the new option to the datalist
                            dataList.appendChild(option);
                        });



                    }).catch(function (error) {
                        console.error(error);
                    });
                });
            }

            // Get USER ID and get EMP ID and ORG CODE
            require(["esri/identity/IdentityManager", "esri/request", "esri/portal/Portal",
                "esri/portal/PortalQueryParams", "dojo/domReady!"
            ], function (IdentityManager, esriRequest, Portal, PortalQueryParams) {
                // Fetch the data when the document is ready
                esriRequest("https://arcportal-ucop-corps.usace.army.mil/s0arcgis/rest/services/Hosted/REMIS_Tasks/FeatureServer/1/query", {
                    responseType: "json",
                    query: {
                        where: "1=1",
                        outFields: "*",

                        f: "json"
                    }

                }).then(function (response) {
                    userid = IdentityManager.credentials[0].userId
                    console.log(userid)
                    // Get the input fields
                    const userSelect = document.getElementById('created_user');

                    userSelect.innerHTML = '';

                    // Sort and iterate through features
                    const sortedFeatures = response.data.features.sort((a, b) => {
                        if (a.attributes.em_name < b.attributes.em_name) return -1;
                        if (a.attributes.em_name > b.attributes.em_name) return 1;
                        return 0;
                    });

                    sortedFeatures.forEach(feature => {
                        const option = document.createElement('option');
                        option.value = feature.attributes.em_name;
                        option.textContent = feature.attributes.em_name;

                        // Check if this user ID matches the logged-in user ID
                        if (feature.attributes.emp_user === userid) {
                            option.selected = true;

                            // Populate other fields
                            document.getElementById('EMP_ID_NO').value = feature.attributes.emp_id_no;
                            selectedEmployee = feature.attributes.emp_id_no;
                            document.getElementById('P_WI_RESPONSIBLE_ORG').value = feature.attributes.org_code;
                            selectedOrg = feature.attributes.org_code;
                            div_dist = feature.attributes.div_dist;
                            document.getElementById('P_DIV_DIST').value = div_dist;
                            selectedDistrict = div_dist;
                            if (div_dist) executeEsriRequest(div_dist);
                        }

                        // Store the feature in the map
                        featureMap.set(option.value, feature);

                        // Append the new option to the select
                        userSelect.appendChild(option);
                    });


                    // Convert the select box into a searchable select box with Select2
                    $(userSelect).select2({
                        width: 'resolve' // need to override the changed width by Select2
                    }).on('select2:select', function (e) {
                        // Get the feature from the map using the selected value
                        const selectedFeature = featureMap.get(e.target.value);

                        if (selectedFeature) {
                            empID = selectedFeature.attributes.emp_id_no;
                            document.getElementById('EMP_ID_NO').value = empID;

                            org_code = selectedFeature.attributes.org_code;
                            document.getElementById('P_WI_RESPONSIBLE_ORG').value = org_code;

                            div_dist = selectedFeature.attributes.div_dist;
                            document.getElementById('P_DIV_DIST').value = div_dist;
                            executeEsriRequest(div_dist)
                            selectedDistrict = div_dist;
                            selectedEmployee = empID
                            selectedOrg = org_code


                        }
                    });
                }).catch(function (error) {
                    console.error(error);
                });

            });
        });
        // create a listener for all state fields and get the latest value when change is detected
        states.forEach(state => {
            state.addEventListener('change', function (e) {
                selectedState = e.target.value;
            });
        });
        counties.forEach(county => {
            county.addEventListener('change', function (e) {
                selectedCounty = e.target.value;
            });
        });
        document.addEventListener('DOMContentLoaded', function() {
  const legends = document.querySelectorAll('.collapsible-legend');
  legends.forEach(legend => {
    legend.addEventListener('click', function() {
      const fieldset = legend.parentElement;
      fieldset.classList.toggle('collapsed');
    });
  });
});

        document.getElementById('dataForm').addEventListener('submit', function (event) {
            // Prevent the default form submit action
            event.preventDefault();
            attributes = {'p_wi_name': document.getElementById('P_WI_NAME').value}
            attributes['p_proj_id'] = document.getElementById('P_PROJ_ID').value
            attributes['p_p2_wi_code'] = document.getElementById('P_P2_WI_CODE').value
            attributes['p_wi_responsible_org'] = document.getElementById('P_WI_RESPONSIBLE_ORG').value
            attributes['p_div_dist'] = document.getElementById('P_DIV_DIST').value
            attributes['p_emp_id_no'] = selectedEmployee
            attributes['p_prim_state'] = selectedState
            attributes['p_prim_county'] = selectedCounty
            attributes['p_active_code'] = selectedActivity
            alert(JSON.stringify(attributes))

        })
    </script>



</body>

</html>